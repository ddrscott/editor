name = "monaco-editor"
main = "worker/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Serve static assets with binding to worker
[assets]
directory = "./dist"
binding = "ASSETS"

# Durable Objects
[durable_objects]
bindings = [
  { name = "SPACE_ROOM", class_name = "SpaceRoom" }
]

# Migration for Durable Objects
[[migrations]]
tag = "v1"
new_classes = ["SpaceRoom"]

# Migrate to SQLite storage
[[migrations]]
tag = "v2"
renamed_classes = [{ from = "SpaceRoom", to = "SpaceRoomLegacy" }]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["SpaceRoom"]
deleted_classes = ["SpaceRoomLegacy"]

# D1 Database for global space queries
[[d1_databases]]
binding = "DB"
database_name = "monaco-spaces"
database_id = "c0722e49-e154-470a-b394-5e5a97a13cef"
migrations_dir = "migrations"

# Development settings
[dev]
port = 8787
